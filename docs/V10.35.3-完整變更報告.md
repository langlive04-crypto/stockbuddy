# StockBuddy V10.35.3 å®Œæ•´è®Šæ›´å ±å‘Š

> å ±å‘Šæ—¥æœŸï¼š2026-01-11
> ç‰ˆæœ¬ï¼šV10.35.2 â†’ V10.35.3
> å ±å‘Šç”¢ç”Ÿè€…ï¼šClaude Code (Ralph Loop è¿­ä»£ #1)

---

## è®Šæ›´æ‘˜è¦

| é¡åˆ¥ | ä¿®æ”¹æª”æ¡ˆæ•¸ | æ–°å¢è¡Œæ•¸ | åˆªé™¤è¡Œæ•¸ |
|------|-----------|---------|---------|
| å‰ç«¯ | 3 | ~150 | ~50 |
| å¾Œç«¯ | 2 | ~180 | ~20 |
| æ–‡æª” | 3 | ~200 | ~50 |

---

## ä¸€ã€App.jsx å‰ç«¯ä¸»ç¨‹å¼è®Šæ›´

**æª”æ¡ˆä½ç½®**: `data/è‚¡ç¥¨ç¨‹å¼é–‹ç™¼/stockbuddy-frontend/src/App.jsx`

### 1. Header å€åŸŸ (ç¬¬ 3055-3146 è¡Œ)

#### 1.1 æ•´é«”å®¹å™¨è®Šæ›´

| é …ç›® | è®Šæ›´å‰ | è®Šæ›´å¾Œ |
|------|--------|--------|
| é¡åˆ¥ | `px-4 py-3` | `px-3 md:px-4 py-2 md:py-3` |
| å½±éŸ¿ | å›ºå®šå…§è· | æ‰‹æ©Ÿç«¯å…§è·ç¸®å° (16pxâ†’12px, 12pxâ†’8px) |

#### 1.2 Logo å€åŸŸ

| é …ç›® | è®Šæ›´å‰ | è®Šæ›´å¾Œ | å½±éŸ¿ |
|------|--------|--------|------|
| å®¹å™¨é–“è· | `gap-3` | `gap-2 md:gap-3` | æ‰‹æ©Ÿç«¯é–“è·ç¸®å° |
| Logo åœ–ç¤º | `text-3xl` | `text-2xl md:text-3xl` | æ‰‹æ©Ÿç«¯ 30pxâ†’24px |
| æ¨™é¡Œå¤§å° | `text-xl` | `text-lg md:text-xl` | æ‰‹æ©Ÿç«¯ 20pxâ†’18px |
| å‰¯æ¨™é¡Œ | ç„¡ hidden | `hidden sm:block` | **æ‰‹æ©Ÿç«¯ (<640px) å®Œå…¨éš±è—** |
| ç‰ˆæœ¬è™Ÿ | V10.35.2 | V10.35.3 | ç‰ˆæœ¬æ›´æ–° |

#### 1.3 å³å´æŒ‰éˆ•å€

| é …ç›® | è®Šæ›´å‰ | è®Šæ›´å¾Œ | å½±éŸ¿ |
|------|--------|--------|------|
| æŒ‰éˆ•é–“è· | `gap-4` | `gap-2 md:gap-4` | æ‰‹æ©Ÿç«¯é–“è·ç¸®å° |

#### 1.4 å¤§ç›¤æŒ‡æ•¸é¡¯ç¤º

| é …ç›® | è®Šæ›´å‰ | è®Šæ›´å¾Œ |
|------|--------|--------|
| ã€ŒåŠ æ¬ŠæŒ‡æ•¸ã€æ¨™ç±¤ | å§‹çµ‚é¡¯ç¤º | `hidden sm:block` - **æ‰‹æ©Ÿç«¯éš±è—** |
| æŒ‡æ•¸æ•¸å€¼ | `{market.value?.toLocaleString()}` | æ¡Œé¢: å®Œæ•´æ•¸å€¼, æ‰‹æ©Ÿ: `22.5K` æ ¼å¼ |
| å­—é«”å¤§å° | `font-medium` | `text-sm md:text-base font-medium` |
| æ¼²è·Œå¹… | åŒè¡Œé¡¯ç¤º | `text-xs md:text-sm` æ‰‹æ©Ÿç«¯ç¸®å° |

**æ‰‹æ©Ÿç«¯é¡¯ç¤ºç¯„ä¾‹**:
- è®Šæ›´å‰: `åŠ æ¬ŠæŒ‡æ•¸ 22,456 (+1.25%)`
- è®Šæ›´å¾Œ: `22.5K (+1.25%)`

#### 1.5 è‡ªå‹•åˆ·æ–°å’ŒåŒ¯å‡ºæŒ‰éˆ•

| é …ç›® | è®Šæ›´å‰ | è®Šæ›´å¾Œ |
|------|--------|--------|
| AutoRefresh | ç›´æ¥æ¸²æŸ“ | åŒ…åœ¨ `hidden md:flex` å®¹å™¨å…§ |
| ExportButton | ç›´æ¥æ¸²æŸ“ | åŒ…åœ¨ `hidden md:flex` å®¹å™¨å…§ |
| å½±éŸ¿ | å§‹çµ‚é¡¯ç¤º | **æ‰‹æ©Ÿç«¯ (<768px) å®Œå…¨éš±è—** |

```jsx
// è®Šæ›´å¾Œçš„ç¨‹å¼ç¢¼
<div className="hidden md:flex items-center gap-2">
  <AutoRefresh onRefresh={fetchData} />
  <ExportButton type="recommendations" label="åŒ¯å‡º" />
</div>
```

#### 1.6 æ›´æ–°æŒ‰éˆ•

| é …ç›® | è®Šæ›´å‰ | è®Šæ›´å¾Œ |
|------|--------|--------|
| é¡åˆ¥ | `px-3 py-1.5` | `p-2 md:px-3 md:py-1.5 min-w-[40px] min-h-[40px]` |
| æŒ‰éˆ•å½¢ç‹€ | æ©¢åœ“å½¢ | æ‰‹æ©Ÿç«¯: æ­£æ–¹å½¢ (40x40px) |
| æŒ‰éˆ•æ–‡å­— | `ğŸ”„ æ›´æ–°` | æ¡Œé¢: `ğŸ”„ æ›´æ–°`, æ‰‹æ©Ÿ: åªæœ‰ `ğŸ”„` |
| è¼‰å…¥ç‹€æ…‹ | `æ›´æ–°ä¸­...` | æ—‹è½‰çš„ `â³` åœ–ç¤º |

```jsx
// è®Šæ›´å¾Œçš„ç¨‹å¼ç¢¼
{loading ? (
  <span className="animate-spin">â³</span>
) : (
  <>
    <span className="md:hidden">ğŸ”„</span>
    <span className="hidden md:inline">ğŸ”„ æ›´æ–°</span>
  </>
)}
```

#### 1.7 å¼·åˆ¶æ›´æ–°æŒ‰éˆ•

| é …ç›® | è®Šæ›´å‰ | è®Šæ›´å¾Œ |
|------|--------|--------|
| é¡åˆ¥ | `px-3 py-1.5 bg-orange-600...` | `hidden md:block px-3 py-1.5 bg-orange-600...` |
| å½±éŸ¿ | å§‹çµ‚é¡¯ç¤º | **æ‰‹æ©Ÿç«¯ (<768px) å®Œå…¨éš±è—** |

---

### 2. Main å€åŸŸå®¹å™¨ (ç¬¬ 3148 è¡Œ)

| é …ç›® | è®Šæ›´å‰ | è®Šæ›´å¾Œ |
|------|--------|--------|
| é¡åˆ¥ | `px-4 py-6` | `px-3 md:px-4 py-4 md:py-6` |
| å½±éŸ¿ | å›ºå®šå…§è· | æ‰‹æ©Ÿç«¯å…§è·æ¸›å°‘ |

---

### 3. ç‹€æ…‹æ¬„ (ç¬¬ 3152-3180 è¡Œ)

#### 3.1 å®¹å™¨

| é …ç›® | è®Šæ›´å‰ | è®Šæ›´å¾Œ |
|------|--------|--------|
| é¡åˆ¥ | `mb-4 ... text-sm mt-3` | `mb-3 md:mb-4 ... text-xs md:text-sm mt-2 md:mt-3` |
| å½±éŸ¿ | å›ºå®šæ¨£å¼ | æ‰‹æ©Ÿç«¯å­—é«”ç¸®å°ã€é–“è·æ¸›å°‘ |

#### 3.2 æƒæçµ±è¨ˆ

| é …ç›® | è®Šæ›´å‰ | è®Šæ›´å¾Œ |
|------|--------|--------|
| æ¡Œé¢é¡¯ç¤º | `ğŸ“¡ æƒæ 70 æª” \| åˆ†æ 70 æª”` | ç›¸åŒ |
| æ‰‹æ©Ÿé¡¯ç¤º | ç›¸åŒ | `ğŸ“¡ 70/70` (ç°¡åŒ–æ ¼å¼) |

```jsx
// è®Šæ›´å¾Œçš„ç¨‹å¼ç¢¼
<span className="hidden sm:inline">ğŸ“¡ æƒæ {scanned} æª” | åˆ†æ {analyzed} æª”</span>
<span className="sm:hidden">ğŸ“¡ {scanned}/{analyzed}</span>
```

#### 3.3 æ—¥æœŸè­¦å‘Šæ¨™ç±¤

| é …ç›® | è®Šæ›´å‰ | è®Šæ›´å¾Œ |
|------|--------|--------|
| æ¡Œé¢é¡¯ç¤º | `{dataDate} èˆŠè³‡æ–™ âš ï¸` | ç›¸åŒ |
| æ‰‹æ©Ÿé¡¯ç¤º | ç›¸åŒ | åªé¡¯ç¤º `âš ï¸` |
| å…§è· | `px-1.5` | `px-1 md:px-1.5` |

```jsx
// è®Šæ›´å¾Œçš„ç¨‹å¼ç¢¼
<span className="ml-1 px-1 md:px-1.5 py-0.5 bg-yellow-500/20 rounded text-xs">
  âš ï¸ <span className="hidden sm:inline">{dataDate} èˆŠè³‡æ–™</span>
</span>
```

#### 3.4 æœ€æ–°è³‡æ–™æ¨™ç¤º

| é …ç›® | è®Šæ›´å‰ | è®Šæ›´å¾Œ |
|------|--------|--------|
| é¡åˆ¥ | `ml-1 text-xs text-emerald-300` | `ml-1 text-xs text-emerald-300 hidden sm:inline` |
| å½±éŸ¿ | å§‹çµ‚é¡¯ç¤º | **æ‰‹æ©Ÿç«¯éš±è—ã€Œæœ€æ–°è³‡æ–™ã€æ–‡å­—** |

#### 3.5 æ›´æ–°æ™‚é–“

| é …ç›® | è®Šæ›´å‰ | è®Šæ›´å¾Œ |
|------|--------|--------|
| é¡åˆ¥ | ç„¡ hidden | `hidden md:inline` |
| å½±éŸ¿ | å§‹çµ‚é¡¯ç¤º | **æ‰‹æ©Ÿç«¯ (<768px) éš±è—æ›´æ–°æ™‚é–“** |

---

### 4. Tab åˆ†é¡åˆ— (ç¬¬ 3182-3208 è¡Œ)

#### 4.1 å®¹å™¨

| é …ç›® | è®Šæ›´å‰ | è®Šæ›´å¾Œ |
|------|--------|--------|
| é–“è· | `gap-2 mb-6` | `gap-1.5 md:gap-2 mb-4 md:mb-6` |
| é‚Šè· | ç„¡ | `-mx-3 px-3 md:mx-0 md:px-0` |
| æ»¾å‹•æ¢ | é è¨­é¡¯ç¤º | æ·»åŠ  `scrollbar-hide` éš±è— |

**å½±éŸ¿**:
- æ‰‹æ©Ÿç«¯ Tab é–“è·ç¸®å°
- æ‰‹æ©Ÿç«¯ Tab åˆ—è¡¨å»¶ä¼¸è‡³è¢å¹•é‚Šç·£
- éš±è—æ°´å¹³æ»¾å‹•æ¢

#### 4.2 Tab æŒ‰éˆ•

| é …ç›® | è®Šæ›´å‰ | è®Šæ›´å¾Œ |
|------|--------|--------|
| å…§è· | `px-4 py-2` | `px-3 md:px-4 py-1.5 md:py-2` |
| å­—é«” | `text-sm` | `text-xs md:text-sm` |
| è§¸æ§ | ç„¡ | æ·»åŠ  `touch-manipulation` |

#### 4.3 Tab æ•¸é‡æ¨™ç¤º

| é …ç›® | è®Šæ›´å‰ | è®Šæ›´å¾Œ |
|------|--------|--------|
| é¡åˆ¥ | `ml-2 text-xs opacity-70` | `ml-1 md:ml-2 text-xs opacity-70 hidden sm:inline` |
| å½±éŸ¿ | å§‹çµ‚é¡¯ç¤º `(5)` | **æ‰‹æ©Ÿç«¯éš±è—æ•¸é‡** |

---

## äºŒã€index.css æ¨£å¼è®Šæ›´

**æª”æ¡ˆä½ç½®**: `data/è‚¡ç¥¨ç¨‹å¼é–‹ç™¼/stockbuddy-frontend/src/index.css`

### æ–°å¢å…§å®¹ (58 è¡Œ)

```css
/* ========================================
 * V10.35.3 æ‰‹æ©Ÿç«¯å„ªåŒ–
 * ======================================== */

/* éš±è—æ»¾å‹•æ¢ - ç”¨æ–¼æ°´å¹³ Tab åˆ—è¡¨ */
.scrollbar-hide {
  -ms-overflow-style: none;  /* IE and Edge */
  scrollbar-width: none;     /* Firefox */
}

.scrollbar-hide::-webkit-scrollbar {
  display: none;  /* Chrome, Safari, Opera */
}

/* è§¸æ§å„ªåŒ– - é˜²æ­¢é›™æ“Šç¸®æ”¾ */
.touch-manipulation {
  touch-action: manipulation;
}

/* æ‰‹æ©Ÿç«¯å„ªåŒ–ï¼šå¢åŠ è§¸æ§ç›®æ¨™å¤§å° */
@media (max-width: 640px) {
  button, a, input, select, textarea {
    min-height: 44px;
    min-width: 44px;
  }

  /* ç¸®å°é–“è· */
  .mobile-compact {
    padding: 0.5rem;
    gap: 0.25rem;
  }
}

/* å®‰å…¨å€åŸŸé©é…ï¼ˆiPhone X åŠä¹‹å¾Œçš„åŠ‰æµ·è¢å¹•ï¼‰*/
@supports (padding-bottom: env(safe-area-inset-bottom)) {
  .safe-area-bottom {
    padding-bottom: env(safe-area-inset-bottom);
  }

  .safe-area-top {
    padding-top: env(safe-area-inset-top);
  }
}

/* é˜²æ­¢é¸å–å’Œé•·æŒ‰å½ˆå‡ºé¸å–® */
.no-select {
  -webkit-user-select: none;
  user-select: none;
  -webkit-touch-callout: none;
}

/* å¹³æ»‘æ»¾å‹• */
@media (prefers-reduced-motion: no-preference) {
  html {
    scroll-behavior: smooth;
  }
}
```

### æ¨£å¼èªªæ˜

| é¡åˆ¥ | ç”¨é€” | å½±éŸ¿ |
|------|------|------|
| `.scrollbar-hide` | éš±è—æ»¾å‹•æ¢ | Tab åˆ—è¡¨æ›´ç°¡æ½” |
| `.touch-manipulation` | é˜²æ­¢é›™æ“Šç¸®æ”¾ | æ”¹å–„è§¸æ§é«”é©— |
| `@media (max-width: 640px)` | æ‰‹æ©Ÿç«¯è§¸æ§ç›®æ¨™ | æ‰€æœ‰æŒ‰éˆ•è‡³å°‘ 44x44px |
| `.safe-area-*` | iPhone åŠ‰æµ·é©é… | å…§å®¹ä¸è¢«é®æ“‹ |
| `.no-select` | é˜²æ­¢é•·æŒ‰é¸å– | é¿å…æ„å¤–é¸å– |

---

## ä¸‰ã€SimulationTrading.jsx æ¨¡æ“¬äº¤æ˜“è®Šæ›´

**æª”æ¡ˆä½ç½®**: `data/è‚¡ç¥¨ç¨‹å¼é–‹ç™¼/stockbuddy-frontend/src/components/SimulationTrading.jsx`

### 1. Import è®Šæ›´

```javascript
// è®Šæ›´å‰
import React, { useState, useMemo, useCallback } from 'react';

// è®Šæ›´å¾Œ
import React, { useState, useMemo, useCallback, useEffect } from 'react';
```

### 2. ç‹€æ…‹ç®¡ç†è®Šæ›´

| é …ç›® | è®Šæ›´å‰ | è®Šæ›´å¾Œ |
|------|--------|--------|
| æ•¸é‡ç‹€æ…‹ | `const [quantity, setQuantity] = useState(1000)` | `const [quantityInput, setQuantityInput] = useState('1000')` |
| æ–°å¢ç‹€æ…‹ | ç„¡ | `const [tradeMessage, setTradeMessage] = useState(null)` |

### 3. æ–°å¢å‡½æ•¸

```javascript
// è§£ææ•¸é‡ï¼Œç¢ºä¿ç‚ºæœ‰æ•ˆæ•¸å­—
const quantity = useMemo(() => {
  const num = parseInt(quantityInput, 10);
  return isNaN(num) || num < 0 ? 0 : num;
}, [quantityInput]);

// è™•ç†æ•¸é‡è¼¸å…¥è®ŠåŒ–
const handleQuantityChange = useCallback((e) => {
  const value = e.target.value;
  // å…è¨±ç©ºå­—ä¸²å’Œæ•¸å­—
  if (value === '' || /^\d+$/.test(value)) {
    setQuantityInput(value);
  }
}, []);

// å¿«é€Ÿè¨­å®šæ•¸é‡
const setQuickQuantity = useCallback((amt) => {
  setQuantityInput(String(amt));
}, []);
```

### 4. äº¤æ˜“éŒ¯èª¤è™•ç†æ”¹å–„

| æƒ…å¢ƒ | è®Šæ›´å‰ | è®Šæ›´å¾Œ |
|------|--------|--------|
| æ•¸é‡ç‚º 0 | `return` (ç„¡æç¤º) | `setTradeMessage({ type: 'error', text: 'è«‹è¼¸å…¥æœ‰æ•ˆæ•¸é‡ï¼' })` |
| ç¾é‡‘ä¸è¶³ | `alert('ç¾é‡‘ä¸è¶³ï¼')` | `setTradeMessage({ type: 'error', text: 'ç¾é‡‘ä¸è¶³ï¼ç„¡æ³•å®Œæˆæ­¤äº¤æ˜“ã€‚' })` |
| æœªæŒæœ‰è‚¡ç¥¨ | `alert('æ²’æœ‰æŒæœ‰æ­¤è‚¡ç¥¨ï¼')` | `setTradeMessage({ type: 'error', text: 'æ²’æœ‰æŒæœ‰æ­¤è‚¡ç¥¨ï¼' })` |
| æŒè‚¡ä¸è¶³ | `alert('æŒè‚¡æ•¸é‡ä¸è¶³ï¼')` | `setTradeMessage({ type: 'error', text: 'æŒè‚¡æ•¸é‡ä¸è¶³ï¼ç›®å‰æŒæœ‰ X è‚¡' })` |

### 5. äº¤æ˜“æˆåŠŸè¨Šæ¯

```javascript
// è²·é€²æˆåŠŸ
setTradeMessage({
  type: 'success',
  text: `æˆåŠŸè²·é€² ${stock.name} ${quantity.toLocaleString()} è‚¡ï¼`
});

// è³£å‡ºæˆåŠŸ
const pnlText = pnl >= 0
  ? `ç²åˆ© $${Math.round(pnl).toLocaleString()}`
  : `è™§æ $${Math.round(Math.abs(pnl)).toLocaleString()}`;
setTradeMessage({
  type: 'success',
  text: `æˆåŠŸè³£å‡º ${stock.name} ${quantity.toLocaleString()} è‚¡ï¼${pnlText}`
});
```

### 6. æ•¸é‡è¼¸å…¥æ¡†è®Šæ›´

| é …ç›® | è®Šæ›´å‰ | è®Šæ›´å¾Œ |
|------|--------|--------|
| è¼¸å…¥é¡å‹ | `type="number"` | `type="text" inputMode="numeric"` |
| å€¼ç¶å®š | `value={quantity}` | `value={quantityInput}` |
| äº‹ä»¶è™•ç† | `onChange={(e) => setQuantity(parseInt(e.target.value) \|\| 0)}` | `onChange={handleQuantityChange}` |
| å±¬æ€§ | `step={1000} min={0}` | `placeholder="è¼¸å…¥æ•¸é‡"` |

### 7. æ–°å¢å¿«é€Ÿæ•¸é‡æŒ‰éˆ•

```jsx
<div className="flex gap-1 mt-1">
  {[1000, 5000, 10000].map(amt => (
    <button
      key={amt}
      onClick={() => setQuickQuantity(amt)}
      className="flex-1 py-1 text-xs bg-slate-600 hover:bg-slate-500 text-slate-300 rounded transition-colors"
    >
      {amt.toLocaleString()}
    </button>
  ))}
</div>
```

### 8. é ä¼°é‡‘é¡é¡¯ç¤ºæ”¹å–„

| é …ç›® | è®Šæ›´å‰ | è®Šæ›´å¾Œ |
|------|--------|--------|
| æ‰‹çºŒè²» | `formatMoney(... * 0.001425)` | `formatMoney(Math.round(... * 0.001425))` |
| è­‰äº¤ç¨… | ç„¡ | è³£å‡ºæ™‚é¡¯ç¤º `+ ç¨… ${...}` |

### 9. æ–°å¢äº¤æ˜“è¨Šæ¯å€å¡Š

```jsx
{tradeMessage && (
  <div className={`mt-3 p-3 rounded-lg text-sm font-medium ${
    tradeMessage.type === 'success'
      ? 'bg-emerald-500/20 text-emerald-300 border border-emerald-500/30'
      : 'bg-red-500/20 text-red-300 border border-red-500/30'
  }`}>
    {tradeMessage.type === 'success' ? 'âœ…' : 'âŒ'} {tradeMessage.text}
  </div>
)}
```

---

## å››ã€stocks.py å¾Œç«¯ API è®Šæ›´

**æª”æ¡ˆä½ç½®**: `data/è‚¡ç¥¨ç¨‹å¼é–‹ç™¼/stockbuddy-backend/app/routers/stocks.py`

### 1. å›æ¸¬ API æ”¹å–„ (ç¬¬ 1872-1928 è¡Œ)

#### 1.1 åƒæ•¸è®Šæ›´

| åƒæ•¸ | è®Šæ›´å‰ | è®Šæ›´å¾Œ |
|------|--------|--------|
| months | ç„¡ | `months: int = Query(None, description="å›æ¸¬æœˆæ•¸")` |
| strategy èªªæ˜ | `ma_crossover, rsi` | `ma_crossover, rsi, macd, bollinger, volume_breakout, combined` |

#### 1.2 æ—¥æœŸè¨ˆç®—æ”¹å–„

```python
# è®Šæ›´å‰
if not start_date:
    start = datetime.now() - timedelta(days=180)
    start_date = start.strftime("%Y-%m-%d")

# è®Šæ›´å¾Œ
if not start_date:
    # å„ªå…ˆä½¿ç”¨ months åƒæ•¸ï¼Œå¦å‰‡é è¨­ 6 å€‹æœˆ
    days = (months or 6) * 30
    start = datetime.now() - timedelta(days=days)
    start_date = start.strftime("%Y-%m-%d")
```

#### 1.3 æ–°å¢æ—¥èªŒè¼¸å‡º

```python
print(f"ğŸ“Š [å›æ¸¬] è‚¡ç¥¨: {stock_id}, ç­–ç•¥: {strategy}, æœŸé–“: {start_date} ~ {end_date}")

# å›æ¸¬å®Œæˆå¾Œ
if "stats" in result:
    stats = result["stats"]
    print(f"âœ… [å›æ¸¬å®Œæˆ] äº¤æ˜“æ¬¡æ•¸: {stats.get('total_trades', 0)}, å ±é…¬ç‡: {stats.get('total_return_pct', 0)}%")
elif "error" in result:
    print(f"âš ï¸ [å›æ¸¬å¤±æ•—] {result.get('error')}")
```

### 2. æ–°å¢ /market-index åˆ¥åè·¯ç”± (ç¬¬ 2248-2273 è¡Œ)

```python
@router.get("/market-index")
async def get_market_index_alias():
    """
    ğŸ“Š å–å¾—å¤§ç›¤æŒ‡æ•¸ï¼ˆåˆ¥åè·¯ç”±ï¼‰

    èˆ‡ /twse/market-index ç›¸åŒï¼Œæä¾›ç›¸å®¹æ€§
    å›å‚³æ ¼å¼é©åˆ MarketDashboard ä½¿ç”¨
    """
    data = await TWSEOpenAPI.get_market_index()

    # å›å‚³ taiex çš„è³‡æ–™ï¼Œæ ¼å¼åŒ–ç‚ºå‰ç«¯æœŸæœ›çš„æ ¼å¼
    if data and "taiex" in data:
        taiex = data["taiex"]
        return {
            "success": True,
            "name": taiex.get("name", "åŠ æ¬ŠæŒ‡æ•¸"),
            "value": taiex.get("value"),
            "change": taiex.get("change"),
            "change_percent": taiex.get("change_percent"),
            "updated_at": datetime.now().isoformat(),
        }

    return {
        "success": False,
        "message": "ç„¡æ³•å–å¾—å¤§ç›¤æŒ‡æ•¸"
    }
```

**è§£æ±ºå•é¡Œ**: å‰ç«¯èª¿ç”¨ `/market-index`ï¼Œä½†å¾Œç«¯åªæœ‰ `/twse/market-index`

### 3. æ–°å¢ /data-status API (ç¬¬ 2847-2941 è¡Œ)

```python
@router.get("/data-status")
async def get_data_status():
    """
    V10.35: å–å¾—è³‡æ–™ç‹€æ…‹ï¼ˆä¾›å‰ç«¯é¡¯ç¤ºï¼‰

    å›å‚³ï¼š
    - data_date: è³‡æ–™æ—¥æœŸ
    - current_date: ä»Šæ—¥æ—¥æœŸ
    - is_stale: è³‡æ–™æ˜¯å¦éæœŸ
    - is_trading_hours: æ˜¯å¦äº¤æ˜“æ™‚æ®µ
    - is_weekend: æ˜¯å¦é€±æœ«
    - message: ç‹€æ…‹è¨Šæ¯
    """
```

#### å›å‚³æ ¼å¼

```json
{
  "success": true,
  "data_date": "2026/01/10",
  "current_date": "2026/01/11",
  "is_stale": false,
  "is_trading_hours": false,
  "is_weekend": true,
  "message": "é€±æœ«ä¼‘å¸‚ï¼Œé¡¯ç¤º 2026/01/10 è³‡æ–™"
}
```

#### åˆ¤æ–·é‚è¼¯

| æƒ…å¢ƒ | is_stale | message |
|------|----------|---------|
| é€±æœ« | false | `é€±æœ«ä¼‘å¸‚ï¼Œé¡¯ç¤º {date} è³‡æ–™` |
| å¹³æ—¥ + è³‡æ–™æ˜¯ä»Šå¤© | false | `è³‡æ–™ç‚ºæœ€æ–°` |
| å¹³æ—¥ + 09:30 å‰ | false | `ç›¤å‰ï¼Œé¡¯ç¤º {date} è³‡æ–™` |
| å¹³æ—¥ + 09:30 å¾Œ + è³‡æ–™éä»Šå¤© | true | `è³‡æ–™éœ€è¦æ›´æ–°ï¼ˆç›®å‰: {date}ï¼‰` |

---

## äº”ã€backtest_engine.py å›æ¸¬å¼•æ“è®Šæ›´

**æª”æ¡ˆä½ç½®**: `data/è‚¡ç¥¨ç¨‹å¼é–‹ç™¼/stockbuddy-backend/app/services/backtest_engine.py`

### 1. æ–°å¢ normalize_date å‡½æ•¸ (ç¬¬ 792-814 è¡Œ)

```python
def normalize_date(date_str):
    """å°‡å„ç¨®æ—¥æœŸæ ¼å¼æ¨™æº–åŒ–ç‚º YYYY-MM-DD"""
    if not date_str:
        return ""
    date_str = str(date_str).strip()

    # å˜—è©¦å„ç¨®æ ¼å¼
    formats = [
        "%Y-%m-%d",
        "%Y/%m/%d",
        "%Y%m%d",
        "%Y.%m.%d",
    ]

    for fmt in formats:
        try:
            dt = datetime.strptime(date_str[:10], fmt)
            return dt.strftime("%Y-%m-%d")
        except:
            continue

    return date_str[:10] if len(date_str) >= 10 else date_str
```

**è§£æ±ºå•é¡Œ**: ä¸åŒè³‡æ–™ä¾†æºçš„æ—¥æœŸæ ¼å¼ä¸ä¸€è‡´

### 2. æ—¥æœŸéæ¿¾é‚è¼¯æ”¹å–„

```python
# æ¨™æº–åŒ–æ­·å²è³‡æ–™ä¸­çš„æ—¥æœŸ
for h in history:
    h["date"] = normalize_date(h.get("date", ""))

# éæ¿¾æ—¥æœŸç¯„åœï¼ˆä½¿ç”¨æ¨™æº–åŒ–å¾Œçš„æ—¥æœŸï¼‰
start_date_norm = normalize_date(start_date)
end_date_norm = normalize_date(end_date)

filtered_history = [
    h for h in history
    if h.get("date") and start_date_norm <= h.get("date", "") <= end_date_norm
]

# å¦‚æœéæ¿¾å¾Œè³‡æ–™ä¸è¶³ï¼Œå˜—è©¦ä½¿ç”¨å…¨éƒ¨æ­·å²è³‡æ–™
if len(filtered_history) < 20 and len(history) >= 30:
    print(f"[Backtest] Warning: Using all available history data instead")
    filtered_history = history
```

### 3. æ”¹å–„éŒ¯èª¤å›å‚³

```python
# è®Šæ›´å‰
return {"error": "æŒ‡å®šæ—¥æœŸç¯„åœè³‡æ–™ä¸è¶³"}

# è®Šæ›´å¾Œ
return {
    "error": "æŒ‡å®šæ—¥æœŸç¯„åœè³‡æ–™ä¸è¶³",
    "details": {
        "required": 20,
        "available": len(filtered_history),
        "date_range": f"{start_date} ~ {end_date}",
        "history_range": f"{min(dates)} ~ {max(dates)}"
    }
}
```

### 4. æ–°å¢è©³ç´°æ—¥èªŒ

```python
print(f"[Backtest] Starting {stock_id}, strategy: {strategy}")
print(f"[Backtest] Need {months} months of history")
print(f"[Backtest] Got {len(history)} history records")
print(f"[Backtest] History date range: {min(dates)} ~ {max(dates)}")
print(f"[Backtest] Filter range: {start_date} ~ {end_date}")
print(f"[Backtest] Filtered records: {len(filtered_history)}")
```

---

## å…­ã€æ–‡æª”è®Šæ›´

### 1. é–‹ç™¼æ—¥èªŒ.md

- æ–°å¢ V10.35.3 Ralph Loop è¿­ä»£è¨˜éŒ„
- æ›´æ–°å•é¡Œæ¸…å–®ç‹€æ…‹
- æ–°å¢ç‰ˆæœ¬ç´€éŒ„

### 2. CLAUDE.md

- ç‰ˆæœ¬è™Ÿ V10.35.2 â†’ V10.35.3
- æ›´æ–°ç³»çµ±ç‹€æ…‹è¡¨æ ¼
- ç§»é™¤å·²è§£æ±ºçš„å•é¡Œæ¸…å–®

### 3. ralph-loop.local.md

- æ–°å¢è¿­ä»£ #1 å®Œæˆå ±å‘Š
- è¨˜éŒ„æ‰€æœ‰ä¿®å¾©é …ç›®
- å®Œæˆåº¦è©•ä¼°

---

## ä¸ƒã€éŸ¿æ‡‰å¼æ–·é»åƒè€ƒ

| æ–·é» | Tailwind é¡åˆ¥ | åƒç´ å¯¬åº¦ |
|------|---------------|---------|
| ç„¡å‰ç¶´ | (é è¨­) | 0px+ |
| sm | `sm:` | 640px+ |
| md | `md:` | 768px+ |
| lg | `lg:` | 1024px+ |
| xl | `xl:` | 1280px+ |

### æ‰‹æ©Ÿç«¯éš±è—å…ƒç´ ç¸½è¦½

| å…ƒç´  | éš±è—æ–·é» | é¡åˆ¥ |
|------|----------|------|
| å‰¯æ¨™é¡Œ (ç‰ˆæœ¬è™Ÿ) | < 640px | `hidden sm:block` |
| ã€ŒåŠ æ¬ŠæŒ‡æ•¸ã€æ¨™ç±¤ | < 640px | `hidden sm:block` |
| å®Œæ•´æŒ‡æ•¸æ•¸å€¼ | < 640px | `hidden sm:inline` |
| è‡ªå‹•åˆ·æ–°å…ƒä»¶ | < 768px | `hidden md:flex` |
| åŒ¯å‡ºæŒ‰éˆ• | < 768px | `hidden md:flex` |
| å¼·åˆ¶æ›´æ–°æŒ‰éˆ• | < 768px | `hidden md:block` |
| æ›´æ–°æŒ‰éˆ•æ–‡å­— | < 768px | `hidden md:inline` |
| å®Œæ•´æƒæçµ±è¨ˆ | < 640px | `hidden sm:inline` |
| èˆŠè³‡æ–™æ—¥æœŸ | < 640px | `hidden sm:inline` |
| ã€Œæœ€æ–°è³‡æ–™ã€æ–‡å­— | < 640px | `hidden sm:inline` |
| æ›´æ–°æ™‚é–“ | < 768px | `hidden md:inline` |
| Tab æ•¸é‡æ¨™ç¤º | < 640px | `hidden sm:inline` |

---

## å…«ã€å·²çŸ¥å½±éŸ¿

### æ‰‹æ©Ÿç«¯åŠŸèƒ½è®Šæ›´

1. **è‡ªå‹•åˆ·æ–°åŠŸèƒ½**: åœ¨æ‰‹æ©Ÿç«¯ç„¡æ³•ä½¿ç”¨ (éœ€è¦æŒ‰æ›´æ–°æŒ‰éˆ•)
2. **åŒ¯å‡ºåŠŸèƒ½**: åœ¨æ‰‹æ©Ÿç«¯ç„¡æ³•ä½¿ç”¨
3. **å¼·åˆ¶æ›´æ–°åŠŸèƒ½**: åœ¨æ‰‹æ©Ÿç«¯ç„¡æ³•ä½¿ç”¨
4. **Tab æ•¸é‡**: æ‰‹æ©Ÿç«¯çœ‹ä¸åˆ°æ¯å€‹åˆ†é¡çš„è‚¡ç¥¨æ•¸é‡

### å»ºè­°çš„å¾ŒçºŒæ”¹é€²

1. æ·»åŠ æ‰‹æ©Ÿç«¯åº•éƒ¨å·¥å…·åˆ—
2. æˆ–æ·»åŠ æ¼¢å ¡é¸å–®æ•´åˆéš±è—åŠŸèƒ½
3. æ·»åŠ ä¸‹æ‹‰åˆ·æ–° (Pull to Refresh) åŠŸèƒ½

---

*å ±å‘ŠçµæŸ*
